<div class="d-flex modify-conditions panel-container skyline" *ngIf="selectedCalc == 'none'">
  <div class="scroll-item chest-column pb-3" [ngStyle]="{'height.px': containerHeight}">
    <div class="col-12">
      <app-treasure-chest-menu (emitChangeEnergyType)="setEnergyType($event)" [treasureHunt]="treasureHunt"
        (emitChangeCalculatorType)="setCaclulatorType($event)"></app-treasure-chest-menu>
    </div>

    <!--lighting replacement-->
    <app-lighting-replacement-card *ngFor="let replacement of treasureHunt.lightingReplacements; let index = index;"
      [replacement]="replacement" [settings]="settings" [index]="index" (emitEditLighting)="editLighting($event, index)"
      (emitEditOpportunitySheet)="editItemOpportunitySheet($event, index, 'lightingReplacement')"
      (emitDeleteItem)="showDeleteItem($event, index, 'lightingReplacement')" [treasureHunt]="treasureHunt"
      (emitSaveTreasureHunt)="save()" [displayCalculatorType]="displayCalculatorType"
      [displayEnergyType]="displayEnergyType">
    </app-lighting-replacement-card>
    <!--replace existing motor-->
    <app-replace-existing-motor-card
      *ngFor="let replaceExistingMotor of treasureHunt.replaceExistingMotors; let index = index;"
      [replaceExistingMotor]="replaceExistingMotor" [index]="index"
      (emitEditOpportunitySheet)="editItemOpportunitySheet($event, index, 'replaceExistingMotor')" [settings]="settings"
      [treasureHunt]="treasureHunt" (emitSaveTreasureHunt)="save()"
      (emitDeleteReplaceExistingMotor)="showDeleteItem($event, index, 'replaceExistingMotor')"
      (emitEditReplaceExistingMotor)="editReplaceExistingMotor($event, index)"
      [displayCalculatorType]="displayCalculatorType" [displayEnergyType]="displayEnergyType">
    </app-replace-existing-motor-card>
    <!--motor drive-->
    <app-motor-drive-card *ngFor="let motorDrive of treasureHunt.motorDrives; let index = index;"
      [motorDrive]="motorDrive" [index]="index"
      (emitEditOpportunitySheet)="editItemOpportunitySheet($event, index, 'motorDrive')" [settings]="settings"
      [treasureHunt]="treasureHunt" (emitSaveTreasureHunt)="save()"
      (emitDeleteItem)="showDeleteItem($event, index, 'motorDrive')" (emitEditItem)="editMotorDrive($event, index)"
      [displayCalculatorType]="displayCalculatorType" [displayEnergyType]="displayEnergyType">
    </app-motor-drive-card>
    <!--natural gas reduction-->
    <app-natural-gas-reduction-card
      *ngFor="let naturalGasReduction of treasureHunt.naturalGasReductions; let index = index;"
      [naturalGasReduction]="naturalGasReduction" [settings]="settings" [index]="index"
      (emitEditNaturalGasReduction)="editNaturalGasReduction($event, index)"
      (emitEditOpportunitySheet)="editItemOpportunitySheet($event, index, 'naturalGasReduction')"
      (emitDeleteItem)="showDeleteItem($event, index, 'naturalGasReduction')" [treasureHunt]="treasureHunt"
      (emitSaveTreasureHunt)="save()" [displayCalculatorType]="displayCalculatorType"
      [displayEnergyType]="displayEnergyType"></app-natural-gas-reduction-card>
    <!--electricity reduction-->
    <app-electricity-reduction-card
      *ngFor="let electricityReduction of treasureHunt.electricityReductions; let index = index;"
      [electricityReduction]="electricityReduction" [settings]="settings" [index]="index"
      (emitEditElectricityReduction)="editElectricityReduction($event, index)"
      (emitEditOpportunitySheet)="editItemOpportunitySheet($event, index, 'electricityReduction')"
      (emitDeleteItem)="showDeleteItem($event, index, 'electricityReduction')" [treasureHunt]="treasureHunt"
      (emitSaveTreasureHunt)="save()" [displayCalculatorType]="displayCalculatorType"
      [displayEnergyType]="displayEnergyType"></app-electricity-reduction-card>
    <!--compressed air reduction-->
    <app-compressed-air-reduction-card
      *ngFor="let compressedAirReduction of treasureHunt.compressedAirReductions; let index = index;"
      [compressedAirReduction]="compressedAirReduction" [settings]="settings" [index]="index"
      (emitEditCompressedAirReduction)="editCompressedAirReduction($event, index)"
      (emitEditOpportunitySheet)="editItemOpportunitySheet($event, index, 'compressedAirReduction')"
      (emitDeleteItem)="showDeleteItem($event, index, 'compressedAirReduction')" [treasureHunt]="treasureHunt"
      (emitSaveTreasureHunt)="save()" [displayCalculatorType]="displayCalculatorType"
      [displayEnergyType]="displayEnergyType"></app-compressed-air-reduction-card>
    <!--standalone opportunity sheet-->
    <app-opportunity-sheet-card *ngFor="let opportunitySheet of treasureHunt.opportunitySheets; let index = index;"
      [opportunitySheet]="opportunitySheet" [index]="index"
      (emitEditOpportunitySheet)="editStandaloneOpportunitySheet($event)" [settings]="settings"
      [treasureHunt]="treasureHunt" (emitSaveTreasureHunt)="save()"
      (emitDeleteOpportunity)="showDeleteItem($event, index, 'opportunitySheet')"
      [displayCalculatorType]="displayCalculatorType" [displayEnergyType]="displayEnergyType">
    </app-opportunity-sheet-card>
  </div>
  <div class="scroll-item result-column justify-content-center mr-3 ml-3"
    [ngStyle]="{'height.px': containerHeight}">
    <app-summary-card [treasureHunt]="treasureHunt" [settings]="settings"></app-summary-card>
  </div>
</div>

<!--edit calcs-->
<app-lighting-replacement *ngIf="selectedCalc == 'lighting-replacement'" [inTreasureHunt]="true"
  (emitSave)="saveEditLighting($event)" (emitCancel)="cancelEditCalc()"
  (emitAddOpportunitySheet)="showOpportunitySheetModal()" [settings]="settings"
  [operatingHours]="treasureHunt.operatingHours"></app-lighting-replacement>

<app-standalone-opportunity-sheet *ngIf="selectedCalc == 'opportunity-sheet'" (emitCancel)="cancelEditCalc()"
  (emitSave)="saveEditOpportunity($event)" [settings]="settings" [(opportunitySheet)]="selectedEditOpportunitySheet">
</app-standalone-opportunity-sheet>

<app-replace-existing *ngIf="selectedCalc == 'replace-existing'" (emitCancel)="cancelEditCalc()"
  (emitSave)="saveEditReplaceExistingMotor($event)" [settings]="settings" [inTreasureHunt]="true"
  [opperatingHours]="opperatingHoursPerYear" (emitAddOpportunitySheet)="showOpportunitySheetModal()">
</app-replace-existing>

<app-motor-drive *ngIf="selectedCalc == 'motor-drive'" (emitCancel)="cancelEditCalc()"
  (emitSave)="saveEditMotorDrive($event)" [settings]="settings" [inTreasureHunt]="true"
  [opperatingHours]="opperatingHoursPerYear" (emitAddOpportunitySheet)="showOpportunitySheetModal()">
</app-motor-drive>

<app-natural-gas-reduction *ngIf="selectedCalc == 'natural-gas-reduction'" [inTreasureHunt]="true"
  (emitSave)="saveEditNaturalGasReduction($event)" (emitCancel)="cancelEditCalc()"
  (emitAddOpportunitySheet)="showOpportunitySheetModal()" [settings]="settings"
  [operatingHours]="opperatingHoursPerYear"></app-natural-gas-reduction>

<app-electricity-reduction *ngIf="selectedCalc == 'electricity-reduction'" [inTreasureHunt]="true"
  (emitSave)="saveEditElectricityReduction($event)" (emitCancel)="cancelEditCalc()"
  (emitAddOpportunitySheet)="showOpportunitySheetModal()" [settings]="settings"
  [operatingHours]="opperatingHoursPerYear"></app-electricity-reduction>

<app-compressed-air-reduction *ngIf="selectedCalc == 'compressed-air-reduction'" [inTreasureHunt]="true"
  (emitSave)="saveEditCompressedAirReduction($event)" (emitCancel)="cancelEditCalc()"
  (emitAddOpportunitySheet)="showOpportunitySheetModal()" [settings]="settings"
  [operatingHours]="opperatingHoursPerYear"></app-compressed-air-reduction>


<div bsModal #saveCalcModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="saveCalcModalLabel" aria-hidden="true" [config]="{backdrop: 'static'}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header p-1">
        <h5 class="mb-0">Save Changes</h5>
        <!-- <button class="close" (click)="closeSaveCalcModal()">
          <span aria-hidden="true">&times;</span>
        </button> -->
      </div>
      <div class="modal-body text-center" *ngIf="itemType != 'opportunitySheet'">
        <p class="help-text" *ngIf="!selectedEditOpportunitySheet">There is no opportunity sheet filled out for this
          opportunity. Would you like to add one
          before saving?</p>
        <p class="help-text" *ngIf="selectedEditOpportunitySheet">Would you like to edit your opportunity sheet before
          saving?</p>
        <a class="click-link" (click)="showOpportunitySheetModal()">
          <img src="assets/images/calculator-icons/opportunity-sheet-icon.png" class="save-opportunity">
        </a> <br>
        <a class="click-link small" (click)="showOpportunitySheetModal()" *ngIf="!selectedEditOpportunitySheet">+Add
          Opportunity Sheet</a>
        <a class="click-link small" (click)="showOpportunitySheetModal()" *ngIf="selectedEditOpportunitySheet">Edit
          Opportunity Sheet</a>
      </div>
      <div class="modal-body text-center" *ngIf="itemType == 'opportunitySheet'">
        <p class="help-text">Are you sure you want to save the changes to your existing opportunity? These changes
          cannot be
          undone.</p>
      </div>
      <div class="modal-footer p-1">
        <button class="btn btn-danger btn-sm pull-right" (click)="hideSaveCalcModal()">Cancel</button>
        <button class="btn btn-primary btn-sm pull-right" (click)="saveEditCalc()"
          *ngIf="itemType != 'opportunitySheet'">Save</button>
        <button class="btn btn-primary btn-sm pull-right" (click)="saveEditOpportunitySheet()"
          *ngIf="itemType == 'opportunitySheet'">Save</button>
      </div>
    </div>
  </div>
</div>


<div bsModal #opportunitySheetModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="opportunitySheetModalLabel" aria-hidden="true" [config]="{backdrop: 'static'}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body pl-0 pr-0" *ngIf="opportunitySheetModal.isShown">
        <app-opportunity-sheet (emitCancel)="hideOpportunitySheetModal()" (emitSave)="saveItemOpportunitySheet($event)"
          [(opportunitySheet)]="selectedEditOpportunitySheet">
        </app-opportunity-sheet>
      </div>
    </div>
  </div>
</div>

<div bsModal #deletedItemModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="deletedItemModalLabel" aria-hidden="true" [config]="{backdrop: 'static'}">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-body p-2 text-center" *ngIf="deletedItemModal.isShown">
        Are you sure you want to delete "{{deleteItemName}}"?<br>
        <span class="small danger">This cannot be undone.</span>
      </div>
      <div class="modal-footer p-2 justify-content-end delete-modal">
        <button class="btn btn-danger" (click)="deleteItem()">Delete</button>
        <button class="btn btn-primary" (click)="cancelDelete()">Cancel</button>
      </div>
    </div>
  </div>
</div>