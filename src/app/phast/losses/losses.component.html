<div class="row modify-conditions">
  <div class="scroll-item" [ngClass]="{'col-6': inSetup, 'col-8': !inSetup}" [ngStyle]="{'height.px': containerHeight}">
    <div class="row row-min-height">
      <div class="modification" (click)="togglePanel(baselineSelected)" [ngClass]="{'disabled': baselineSelected == false, 'modal-open': isModalOpen == true, 'baseline':!inSetup,  'col-12': inSetup, 'col-md-6': !inSetup}">
        <div class="header d-flex flex-row justify-content-between">
          <h3>Baseline</h3>
          <h5 class="pull-right panel-add" *ngIf="inSetup && !modificationExists && selectedTab.showAdd">
            <a class="small" [ngClass]="{'disabled': !baselineSelected}">
              <span *ngIf="selectedTab.componentStr != 'charge-material'" (click)="addLoss()">+Add Loss</span>
              <span *ngIf="selectedTab.componentStr == 'charge-material'" (click)="addLoss()">+Add Charge Material</span>
            </a>
          </h5>
        </div>

        <div class="losses-container phast-losses-container">
          <app-charge-material (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'charge-material'"
            [isBaseline]="true" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-charge-material>

          <app-wall-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [addLossToggle]="addLossToggle" [(losses)]="phast.losses" *ngIf="selectedTab.componentStr == 'wall-losses'" [isBaseline]="true"
            (emitDelete)="removeWallLoss($event)" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup"
            [modExists]="modificationExists"></app-wall-losses>

          <app-atmosphere-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'atmosphere-losses'"
            [isBaseline]="true" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-atmosphere-losses>

          <app-fixture-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'fixture-losses'"
            [isBaseline]="true" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-fixture-losses>

          <app-opening-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'opening-losses'"
            [isBaseline]="true" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-opening-losses>

          <app-cooling-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'cooling-losses'"
            [isBaseline]="true" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-cooling-losses>

          <app-flue-gas-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'flue-gas-losses'"
            [isBaseline]="true" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-flue-gas-losses>

          <app-gas-leakage-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'gas-leakage-losses'"
            [isBaseline]="true" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-gas-leakage-losses>

          <app-extended-surface-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'extended-surface-losses'"
            [isBaseline]="true" [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-extended-surface-losses>

          <app-other-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'other-losses'" [isBaseline]="true"
            [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-other-losses>

          <app-slag (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()" [(losses)]="phast.losses"
            [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'slag'" [isBaseline]="true" [settings]="settings"
            [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-slag>

          <app-energy-input (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" *ngIf="selectedTab.componentStr == 'energy-input'" [isBaseline]="true"
            [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-energy-input>

          <app-exhaust-gas (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" [isBaseline]="true" *ngIf="selectedTab.componentStr == 'exhaust-gas'"
            [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-exhaust-gas>

          <app-auxiliary-power-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" [settings]="settings" *ngIf="selectedTab.componentStr == 'auxiliary-power'"
            [isBaseline]="true" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-auxiliary-power-losses>

          <app-energy-input-exhaust-gas-losses (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [(losses)]="phast.losses" [addLossToggle]="addLossToggle" [isBaseline]="true" *ngIf="selectedTab.componentStr == 'energy-input-exhaust-gas'"
            [settings]="settings" [isLossesSetup]="isLossesSetup" [inSetup]="inSetup" [modExists]="modificationExists"></app-energy-input-exhaust-gas-losses>

          <app-heat-system-efficiency *ngIf="selectedTab.componentStr == 'heat-system-efficiency'" [(losses)]="phast.losses" [(phast)]="phast"
            [isBaseline]="true" (fieldChange)="changeField($event)" [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()"
            [settings]="settings" [inSetup]="inSetup" [modExists]="modificationExists"></app-heat-system-efficiency>

          <app-operations *ngIf="selectedTab.componentStr == 'operations'" [(phast)]="phast" [isBaseline]="true" (fieldChange)="changeField($event)"
            [baselineSelected]="baselineSelected" (savedLoss)="saveModifications()" [settings]="settings"></app-operations>
        </div>
      </div>
      <!--Modification Start -->
      <div class="modification col-6" *ngIf="_modifications.length != 0 && !inSetup" (click)="togglePanel(modificationSelected)"
        [ngClass]="{'disabled': modificationSelected == false, 'modal-open': isModalOpen == true}">

        <!-- Modification Header -->
        <div class="header d-flex flex-row justify-content-between">
          <h3 *ngIf="_modifications[modificationIndex]">{{_modifications[modificationIndex].phast.name}}</h3>
          <!-- <h5 class="pull-right add-loss">
            <a class="small click-link" [ngClass]="{'disabled-link': !modificationSelected}">
              <span *ngIf="!isDropdownOpen" (click)="toggleDropdown()">Change / Add</span>
              <span *ngIf="isDropdownOpen && !showEditModification" (click)="toggleDropdown()">Cancel</span>
            </a>
          </h5> -->
        </div>

        <div class="losses-container phast-losses-container" *ngIf="!isDropdownOpen">
          <app-charge-material (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'charge-material'"
            [settings]="settings" [isLossesSetup]="isLossesSetup" [isLossesSetup]="isLossesSetup"></app-charge-material>

          <app-wall-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'wall-losses'" [settings]="settings"
            [isLossesSetup]="isLossesSetup"></app-wall-losses>

          <app-atmosphere-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'atmosphere-losses'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-atmosphere-losses>

          <app-fixture-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'fixture-losses'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-fixture-losses>

          <app-opening-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'opening-losses'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-opening-losses>

          <app-cooling-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'cooling-losses'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-cooling-losses>

          <app-flue-gas-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'flue-gas-losses'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-flue-gas-losses>

          <app-gas-leakage-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'gas-leakage-losses'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-gas-leakage-losses>

          <app-extended-surface-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'extended-surface-losses'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-extended-surface-losses>

          <app-other-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'other-losses'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-other-losses>

          <app-slag (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'slag'" [settings]="settings"
            [isLossesSetup]="isLossesSetup"></app-slag>

          <app-energy-input (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'energy-input'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-energy-input>

          <app-exhaust-gas (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'exhaust-gas'" [settings]="settings"
            [isLossesSetup]="isLossesSetup"></app-exhaust-gas>

          <app-auxiliary-power-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" [settings]="settings" *ngIf="selectedTab.componentStr == 'auxiliary-power'"
            [isLossesSetup]="isLossesSetup"></app-auxiliary-power-losses>

          <app-energy-input-exhaust-gas-losses (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [(losses)]="_modifications[modificationIndex].phast.losses" *ngIf="selectedTab.componentStr == 'energy-input-exhaust-gas'"
            [settings]="settings" [isLossesSetup]="isLossesSetup"></app-energy-input-exhaust-gas-losses>

          <app-heat-system-efficiency *ngIf="selectedTab.componentStr == 'heat-system-efficiency'" [(losses)]="_modifications[modificationIndex].phast.losses"
            [phast]="_modifications[modificationIndex].phast" (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected"
            (savedLoss)="saveModifications()" [settings]="settings"></app-heat-system-efficiency>

          <app-operations *ngIf="selectedTab.componentStr == 'operations'" [(phast)]="_modifications[modificationIndex].phast" [isBaseline]="false"
            (fieldChange)="changeField($event)" [baselineSelected]="modificationSelected" (savedLoss)="saveModifications()"
            [settings]="settings"></app-operations>

        </div>

        <!-- <div class="modifications-list" *ngIf="isDropdownOpen">
          <ul *ngIf="!showEditModification">
            <li *ngFor="let modification of _modifications">
              <button>
                <a (click)="selectModification(modification)">
                  {{modification.phast.name}}
                </a>
                <a class="pull-right click-link" (click)="dispEditModification(modification)">Edit / Delete</a>
              </button>
            </li>
            <li class="add-modification">
              <button class="btn btn-primary" (click)="addModification()">Add Modified Condition</button>
              <p>Data will be copied from
                <br/> your baseline operating condition</p>
            </li>
          </ul>
          <div class="losses-container edit-modification" *ngIf="showEditModification && editModification">
            <app-edit-condition-properties [modification]="editModification" (deleteMod)="deleteModification()" (saveMod)="saveModifications()"
              (cancelEdit)="cancelEdit()"></app-edit-condition-properties>
          </div>
        </div> -->
      </div>
      <div class="no-data col-6" *ngIf="_modifications.length == 0 && !inSetup">
        <h3>Now that your baseline set up, click below to start adding modifications.</h3>
        <button type="button" (click)="newModification()">Add Modified Condition</button>
        <p>Data will be copied from your current baseline condition. You will not be able to add or remove losses after creating
          a modification.</p>
      </div>
    </div>
    <!--end row-->
  </div>
  <!--end col -->
  <div class="no-padding-left" [ngClass]="{'col-md-6': inSetup, 'col-md-4': !inSetup}" [ngStyle]="{'height.px': containerHeight}">
    <app-losses-result-panel *ngIf="!inSetup" [inSetup]="inSetup" [lossesTab]="selectedTab" [currentField]="currentField" [settings]="settings"
      [phast]="phast" [toggleCalculate]="toggleCalculate" [modification]="_modifications[modificationIndex]" [containerHeight]="containerHeight"
      (emitSave)="saveModifications()"></app-losses-result-panel>
    <app-losses-result-panel *ngIf="inSetup" [inSetup]="inSetup" [lossesTab]="selectedTab" [currentField]="currentField" [settings]="settings"
      [phast]="phast" [toggleCalculate]="toggleCalculate" [containerHeight]="containerHeight" (emitSave)="saveModifications()"></app-losses-result-panel>
  </div>


  <div class="setup-dialog" *ngIf="!phast.disableSetupDialog">
    <app-losses-splash-page (hidePage)="hideSetupDialog()"></app-losses-splash-page>
  </div>
</div>

<!-- <div bsModal #addModificationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addModificationModalLabel"
  aria-hidden="true" [config]="{backdrop: 'static'}">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Warning</h3>
        <button class="close" (click)="closeModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>
          You are about to add your first modification to your system. After doing so you will not be able to add or remove losses
          from your baseline. You will need to delete all of your modifications to add or remove losses from your baseline.
          Do you wish to proceed?
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-primary" (click)="addModification()" data-dismiss="modal">Yes</button>
        <button type="button" class="btn btn-default btn-secondary" (click)="closeModal()" data-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div> -->

<div bsModal #editModificationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="editModificationModalLabel"
  aria-hidden="true" [config]="{backdrop: 'static'}">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Modifications</h3>
        <button class="close" (click)="hideEditModificaiton()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <app-edit-condition-properties [modifications]="_modifications" (deleteMod)="deleteModification()" (saveMod)="saveModifications()"
          (cancelEdit)="cancelEdit()"></app-edit-condition-properties>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Yes</button>
        <button type="button" class="btn btn-default btn-secondary" (click)="hideEditModificaiton()" data-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div>



<!-- <div bsModal #changeModificationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="changeModificationModalLabel"
  aria-hidden="true" [config]="{backdrop: 'static'}" *ngIf="modificationExists">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Select Modification</h3>
        <button class="close" (click)="closeSelectModification()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <app-modification-list [phast]="phast" [modifications]="_modifications" [modificationIndex]="modificationIndex" (emitSelectModification)="selectModification($event)"></app-modification-list>
      </div>
    </div>
  </div>
</div> -->

<div bsModal #addNewModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addNewModalLabel" aria-hidden="true"
  [config]="{backdrop: 'static'}">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Modification</h3>
        <button class="close" (click)="closeNewModification()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <app-add-modification [phast]="phast" [modifications]="_modifications" [modificationExists]="modificationExists" (save)="saveNewMod($event)"></app-add-modification>
      </div>
    </div>
  </div>
</div>

<div bsModal #deleteModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true"
  [config]="{backdrop: 'static'}" *ngIf="modificationExists">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Are you sure you want to delete {{_modifications[modificationIndex].phast.name}}?</h3>
        <button class="close" (click)="closeDeleteModification()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="small">This cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger pull-right" (click)="deleteModification()">Yes Delete Modification</button>
      </div>
    </div>
  </div>
</div>

<div bsModal #renameModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="renameModalLabel" aria-hidden="true"
  [config]="{backdrop: 'static'}">
  <div class="modal-dialog modal-md" *ngIf="modificationExists">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Rename Modification</h3>
        <button class="close" (click)="closeRenameModification()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label>Modification Name</label>
            <input name="newAssessmentName" type="text" class="form-control" [(ngModel)]="changeName">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary pull-right" (click)="updateName()">Save Name</button>
      </div>
    </div>
  </div>
</div>



<ng2-toasty></ng2-toasty>